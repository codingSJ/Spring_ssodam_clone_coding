<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/index.css}" rel="stylesheet" type="text/css">
    <title>ssodam clone</title>
    <style>
        table {
            width: 100%;
            border: 1px solid #444444;
        }
        th, td {
            border: 1px solid #444444;
        }
    </style>
</head>
<body>
<h1>SSODAM</h1>


<td th:text="'title: '+${post.getTitle()}"></td>
<td th:text="'member: '+${post.getMember().getUsername()}"></td>
<td th:text="'content: '+${post.getContents()}"></td>
<br><br>

<table id="tr">
<tbody>
<tr>
    <th>번호+날짜</th>
    <th>내용</th>
    <th>답글</th>
</tr>
<tr th:each="comment,commentStat: ${post.getComments()}">
    <td th:text="${comment.member.username} + ' ' + ${comment.createTime}"></td>
<!--    <br>-->
    <td th:text="'comment '+${commentStat.index} + ' : ' +${comment.getContent()}"></td>
    <td>
    <button th:postId="${post.id}" th:commentId="${comment.id}"
            th:csrf="${_csrf.parameterName}" th:token="${_csrf.token}"
            onclick="createSubCommentForm(this.getAttribute('postId'), this.getAttribute('commentId'),
                        this.getAttribute('csrf'), this.getAttribute('token'))">답글달기</button>
    </td>
    <br>
    <div id="com"></div>
</tr>
<tr>
    <div class="col-lg-4">
    <td>
        <form th:object="${commentForm}" role="form" method="post"
              th:action="@{content/{postId}/comments (postId=${post.id})}">
            <input type="text" th:field="*{contents}" class="form-control" placeholder="댓글달기">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit" class="btn btn-primary">입력</button>
        </form>
    </td>
    </div>
</tr>
</tbody>
</table>


<script>
    function createSubCommentForm(postId, commentId, csrf_parameterName, csrf_token){
        let tr = document.createElement('tr');

        let form = document.createElement('form');
        let action = "content/subComment/" + commentId;
        form.setAttribute("charset", "UTF-8");
        form.setAttribute("method", "Post");  //Post 방식
        form.setAttribute("action", action); //요청 보낼 주소

        let content = document.createElement('input');
        content.setAttribute('type', 'text');
        content.setAttribute('name', 'content');

        let csrf = document.createElement('input');
        csrf.setAttribute('type', 'hidden');
        csrf.setAttribute('name', csrf_parameterName);
        csrf.setAttribute('value', csrf_token);

        let button = document.createElement('input');
        button.setAttribute('type', 'submit');
        button.setAttribute('text', 'submit');
        button.setAttribute('value', 'submit');

        form.appendChild(content);
        form.appendChild(csrf);
        form.appendChild(button);
        tr.appendChild(form);

        document.getElementById('tr').appendChild(tr);
    }
</script>
</body>
</html>